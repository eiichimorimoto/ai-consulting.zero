# 📝 Implementation Plan: リッチアウトプット機能（プロトタイプ）

## プロジェクト構造

```
ai-consulting-zero/
├── app/
│   ├── api/
│   │   └── tools/
│   │       └── generate-presentation/
│   │           └── route.ts ← 新規作成
│   └── consulting/
│       └── start/
│           └── page.tsx ← 修正
├── components/
│   └── consulting/
│       └── TestPPTButton.tsx ← 新規作成
├── lib/
│   └── ppt/
│       ├── generator.ts ← 新規作成
│       └── templates.ts ← 新規作成
└── package.json ← 依存関係追加
```

---

## タスクリスト

### Task 1: 依存関係の追加
- **目的**: pptxgenjsライブラリをインストール
- **依存**: なし
- **成果物**: 
  - `package.json` 更新
- **見積もり**: 5分
- **優先度**: 最高
- **変更通知必須**: いいえ

**コマンド**:
```bash
npm install pptxgenjs@3.12.0
npm install --save-dev @types/pptxgenjs
```

---

### Task 2: PPT生成ユーティリティの作成
- **目的**: PPT生成ロジックをモジュール化
- **依存**: Task 1
- **成果物**:
  - `lib/ppt/generator.ts` (新規作成・保護レベル3)
  - `lib/ppt/templates.ts` (新規作成・保護レベル3)
- **見積もり**: 30分
- **優先度**: 高
- **変更通知必須**: いいえ

**内容**:
- テンプレート定義
- PPT生成関数
- Base64変換関数

---

### Task 3: API Route の作成
- **目的**: PPT生成APIエンドポイント
- **依存**: Task 2
- **成果物**:
  - `app/api/tools/generate-presentation/route.ts` (新規作成・保護レベル3)
- **見積もり**: 30分
- **優先度**: 最高
- **変更通知必須**: いいえ

**機能**:
- POSTリクエスト受付
- pptxgenjs実行
- Base64エンコード
- エラーハンドリング

---

### Task 4: テストボタンコンポーネントの作成
- **目的**: プロトタイプ用のUI
- **依存**: Task 3
- **成果物**:
  - `components/consulting/TestPPTButton.tsx` (新規作成・保護レベル3)
- **見積もり**: 30分
- **優先度**: 高
- **変更通知必須**: いいえ

**機能**:
- ボタンUI
- API呼び出し
- ローディング状態
- ダウンロード処理
- エラー表示

---

### Task 5: AI相談画面への統合
- **目的**: テストボタンを画面に配置
- **依存**: Task 4
- **成果物**:
  - `app/consulting/start/page.tsx` 修正 (保護レベル3)
- **見積もり**: 15分
- **優先度**: 中
- **変更通知必須**: いいえ（レベル3）

**変更箇所**:
- TestPPTButtonのインポート追加
- 開発環境でのみ表示（`process.env.NODE_ENV === 'development'`）

---

### Task 6: 動作確認・テスト
- **目的**: 正常動作の確認
- **依存**: Task 5
- **成果物**: テスト結果レポート
- **見積もり**: 20分
- **優先度**: 最高
- **変更通知必須**: いいえ

**確認項目**:
- ✅ ボタンクリック
- ✅ PPT生成
- ✅ ダウンロード
- ✅ PowerPointで開く
- ✅ 日本語表示確認

---

### Task 7: コミット
- **目的**: Gitにコミット
- **依存**: Task 6
- **成果物**: Gitコミット
- **見積もり**: 5分
- **優先度**: 中
- **変更通知必須**: いいえ

**コミットメッセージ**:
```
feat: リッチアウトプット機能プロトタイプ（PPT生成）

- pptxgenjsライブラリ追加
- PPT生成API Route作成
- テスト用ボタンコンポーネント追加
- 開発環境でテスト可能
```

---

## 実装順序

```
Task 1 (依存関係追加) 
  ↓
Task 2 (PPT生成ユーティリティ)
  ↓
Task 3 (API Route)
  ↓
Task 4 (テストボタン)
  ↓
Task 5 (画面統合)
  ↓
Task 6 (動作確認)
  ↓
Task 7 (コミット)
```

**実装方針**: ボトムアップ（低レベル→高レベル）

---

## 総見積もり時間

| タスク | 時間 |
|-------|------|
| Task 1 | 5分 |
| Task 2 | 30分 |
| Task 3 | 30分 |
| Task 4 | 30分 |
| Task 5 | 15分 |
| Task 6 | 20分 |
| Task 7 | 5分 |
| **合計** | **約2時間15分** |

---

## リスク管理

### リスク1: pptxgenjsの日本語フォント対応
**対策**: デフォルトフォントで試し、必要に応じてフォント埋め込み

### リスク2: Vercelのメモリ制限
**対策**: 固定テンプレート（3スライド）でサイズ最小化

### リスク3: Base64サイズ制限
**対策**: 生成後のファイルサイズを確認（目標: 1MB以下）

---

## 成功基準

### 完了条件（Phase C）
- ✅ すべてのタスクが完了
- ✅ PPTファイルがダウンロードできる
- ✅ PowerPointで正常に開ける
- ✅ 日本語が正しく表示される
- ✅ エラー時に適切なメッセージが表示される

---

## 次のステップ（Phase A）

Phase C成功後、以下を検討：

1. **Difyツール統合**
   - Workflow設定
   - ツール定義

2. **動的コンテンツ生成**
   - AIの回答を元にスライド生成

3. **Supabase Storage保存**
   - ファイル永続化

4. **履歴管理**
   - 生成済みファイル一覧

---

**作成日**: 2026-02-07
**Phase**: Plan
**次フェーズ**: Implement（実装開始）
