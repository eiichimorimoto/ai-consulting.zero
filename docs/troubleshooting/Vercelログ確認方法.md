# Vercelのエラーログ確認方法

## 📋 Vercelのエラーログとは？

Vercelにデプロイしたアプリケーションが実行された時に、サーバー側で出力されるログメッセージのことです。
PDF読み取りなどの処理でエラーが発生すると、このログに詳細な情報が記録されます。

## 🔍 ログを確認する手順

### 方法1: Vercelダッシュボードで確認（最も簡単）

1. **Vercelダッシュボードにアクセス**
   - https://vercel.com/dashboard
   - ログインしてください

2. **プロジェクトを選択**
   - 「ai-consulting-zero」プロジェクトをクリック

3. **デプロイメントを選択**
   - 「Deployments」タブを開く
   - 最新のデプロイメント（コミット `6b21dfb` など）をクリック

4. **ログを確認**
   - 「Functions」タブを開く
   - `/api/ocr-business-card` をクリック
   - 「Logs」タブでエラーログを確認

### 方法2: リアルタイムログを確認

1. **Vercelダッシュボードでプロジェクトを開く**

2. **「Logs」タブを開く**
   - 左側のメニューから「Logs」を選択

3. **PDF読み取りを実行**
   - ブラウザでPDFをアップロード
   - ログがリアルタイムで表示されます

## 📝 PDF読み取り時のログ例

### 正常な場合のログ

```
🔍 Vercel環境を検出、pdfjs-dist + canvasを使用します
📄 pdfjs-dist + canvasを使用してPDFを変換します...
⚠️ Vercel環境ではpdfjs-distのワーカー設定が必要です
✅ pdfjs-dist/legacy/build/pdf.mjs を読み込みました
✅ pdfjs-distワーカーを無効化（メインスレッドで処理）
✅ Node.js環境を検出、ワーカーなしで処理します
✅ canvas を読み込みました
📖 PDFを読み込み中... (サイズ: 385672 bytes)
📄 PDF読み込み完了 (総ページ数: 1)
📐 ページ1のビューポート: 595x842
🖼️ スケール: 2.43, 出力サイズ: 1446x2048
🎨 PDFをCanvasにレンダリング中...
✅ レンダリング完了
✅ PNG変換完了 (サイズ: 245678 bytes)
```

### エラーが発生した場合のログ

```
🔍 Vercel環境を検出、pdfjs-dist + canvasを使用します
📄 pdfjs-dist + canvasを使用してPDFを変換します...
❌ PDF→PNG変換（pdfjs-dist）エラー: Cannot find module '/var/task/.next/server/chunks/pdf.worker.mjs'
❌ pdfjs-dist変換エラー: PDF→PNG変換に失敗しました（Vercel環境）: ...
```

## 🎯 確認すべきポイント

### 1. ワーカー設定が正しく動作しているか

以下のログが表示されていればOK：
```
✅ pdfjs-distワーカーを無効化（メインスレッドで処理）
✅ Node.js環境を検出、ワーカーなしで処理します
```

### 2. PDF変換が成功しているか

以下のログが表示されていればOK：
```
✅ PNG変換完了 (サイズ: ... bytes)
```

### 3. エラーが発生していないか

以下のようなログが表示されていたら問題あり：
```
❌ PDF→PNG変換（pdfjs-dist）エラー: ...
❌ pdfjs-dist変換エラー: ...
```

## 🔧 エラーログの見方

### エラーログの構造

```
❌ PDF→PNG変換（pdfjs-dist）エラー: [エラーメッセージ]
スタックトレース: [エラーの詳細な場所]
```

### よくあるエラーと対処法

1. **`Cannot find module 'pdf.worker.mjs'`**
   - 原因: ワーカーファイルが見つからない
   - 対処: ワーカーを無効化する設定が正しく動作しているか確認

2. **`DOMMatrix is not defined`**
   - 原因: Node.js環境でDOMMatrixが定義されていない
   - 対処: DOMMatrixのpolyfillが正しく動作しているか確認

3. **`canvas module not found`**
   - 原因: canvasモジュールがインストールされていない
   - 対処: `package.json`に`canvas`が含まれているか確認

## 💡 ヒント

- **ログは時系列で表示されます** - 上から下へ時間順に表示されます
- **エラーが発生したら、その前後のログも確認** - エラーの原因を特定するのに役立ちます
- **ログをコピーする** - エラーログを選択してコピーして、問題解決に役立ててください

## 📞 問題が解決しない場合

エラーログをコピーして、以下の情報と一緒に共有してください：
- エラーメッセージ全文
- エラーが発生したタイミング（PDFアップロード時など）
- ブラウザのコンソールエラー（あれば）
ダーダー