# Difyプロンプト追記：PDF・レポート出力について

> 目的: AIが「このプラットフォームではPDFを作成できません」と誤答しないようにする

---

## 問題

ユーザーが「PDFで出力して」「レポートをPDFで」などと依頼すると、Difyが次のように回答することがある。

- 「このプラットフォームではPDFファイルの作成や送信を行うことはできません」
- 「ご自身でPDFを作成いただくことをお勧めします」

**実際には**、このアプリでは **左メニューの「レポートをエクスポート」** から会話内容をPDFでダウンロードできる。

---

## 対応：Difyのシステムプロンプト／指示に追記

Difyのチャットフロー（または該当するワークフロー）の **システムプロンプト** または **指示** に、以下を追記する。

### 追記する文言（コピー用）

```
【レポート・PDF出力について】
- このプラットフォームでは、会話内容をPDFでダウンロードする機能があります。
- ユーザーが「PDFで出力して」「レポートをPDFで」などと依頼した場合は、次のように案内してください。
  「PDFは画面左のメニュー下部にある『レポートをエクスポート』ボタンからダウンロードできます。会話の内容を選択して、プレビュー後にPDFをダウンロードできます。」
- 「このプラットフォームではPDFを作成できません」とは回答しないでください。PDF出力は左メニューの「レポートをエクスポート」で利用可能です。
```

### 短い案内用テンプレート（AIがユーザーに伝える文例）

- **日本語**: 「PDFのダウンロードは、画面左の『レポートをエクスポート』ボタンから行えます。会話内容を選んでプレビューし、PDFを保存できます。」
- **補足**: 「レポートが準備できると、ボタン横に『✓ N件』と表示されます。」

---

## 反映手順（Dify上）

1. Difyの該当 **チャットフロー** を開く。
2. **開始ノード** または **システムプロンプトを編集できるノード** を開く。
3. 上記「追記する文言」を、既存のシステムプロンプトの末尾（または適切なブロック）に追加して保存。
4. 必要に応じてワークフローを再公開する。

これにより、PDF依頼時に「PDFは作れません」と答える代わりに、「左メニューのレポートをエクスポートからダウンロードできます」と案内できる。

---

## Dify側でできること（まとめ）

アプリ側のレポート・プレビュー・確認フローを補うため、**Difyのプロンプトやワークフローで以下を入れておくとよい**。

### 1. 自分を「AI」として答える

- **「Dify」「このプラットフォーム」と言わない**
  - ユーザーには常に「AI」として応答する。製品名や「このプラットフォームでは〜できません」といった言い回しは使わない。
- **追記例**  
  「あなたはAIコンサルタントです。回答時には『Dify』『このプラットフォーム』などの固有名詞は使わず、『AI』として説明してください。」

### 2. レポート・PDF依頼時の案内（上記の通り）

- 「レポートをエクスポート」からPDF/PPTがダウンロードできることを案内する。
- 「PDFは作れません」と答えない。

### 3. レポート依頼時の「確認」フレーズ

- ユーザーが「レポートを作って」「この内容でレポートを」などと言ったときは、**内容をまとめたうえで**次のように確認する。
- **追記例**  
  「ユーザーがレポート作成を依頼した場合は、提案内容を簡潔にまとめ、最後に『この内容でレポートを作成してよろしいですか？ よろしければ画面左の「レポートをエクスポート」からPDFまたはPowerPointでダウンロードできます。』と案内してください。」

### 4. 回答の構造化（レポート成型しやすくする）

- **見出し（# や ##）・箇条書き・段落**をはっきりつけると、アプリ側でレポート用HTMLに変換しやすい。
- セクション名を「エグゼクティブサマリー」「分析」「提言」「まとめ」に近づけると、アプリ側のセクション判定（分析／提言／サマリー）が効き、PDFの構成が整いやすい。

### 5. レポート構成案を先に出す（任意）

- 「レポートとしてまとめます」と返すとき、**目次や構成案**（例: 1. 概要 2. 分析 3. 提言 4. まとめ）を先に提示すると、ユーザーが「このようなレポートで」と確認しやすくなる。
- そのあとで「この内容でよろしければ『レポートをエクスポート』からダウンロードできます」と案内する。

---

## 反映の優先度

| 優先度 | 項目 | 効果 |
|--------|------|------|
| 高 | 1. AIとして答える／Difyと言わない | 表記の一貫性、誤解の防止 |
| 高 | 2. PDF依頼時の案内（既存の追記文言） | 「作れません」誤答の防止 |
| 中 | 3. レポート依頼時の確認フレーズ | 「この内容でよろしいですか？」の実現 |
| 中 | 4. 回答の構造化 | PDFの見た目・成型のしやすさ |
| 低 | 5. 構成案の先行提示 | 確認フローの補強 |
