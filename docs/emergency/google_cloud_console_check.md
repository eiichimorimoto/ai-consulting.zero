# Google Cloud Console 使用状況確認手順

## 📋 Step 1: APIダッシュボードを開く

### 1-1. ブラウザで以下のURLにアクセス
```
https://console.cloud.google.com/apis/dashboard
```

### 1-2. プロジェクトを確認
- 左上にプロジェクト名が表示される
- PageSpeed APIキーを作成したプロジェクトが選択されているか確認
- 違う場合は、プロジェクト名をクリックして切り替え

---

## 📊 Step 2: PageSpeed Insights API の指標を確認

### 2-1. API一覧から探す

**方法A**: スクロールして探す
- ダッシュボードのAPI一覧をスクロール
- 「PageSpeed Insights API」を探す

**方法B**: 検索する（推奨）
- 画面上部の検索ボックスに「PageSpeed」と入力
- 「PageSpeed Insights API」をクリック

### 2-2. 「指標」タブをクリック

### 2-3. グラフで確認すべきこと

**① トラフィック（リクエスト数）のグラフ**
```
確認ポイント:
- 過去24時間の合計リクエスト数
- 急増したタイミング
- 現在のリクエスト数
```

**スクリーンショット例**:
```
[グラフイメージ]
リクエスト数
    │  ▲
25k │ ███
    │ ███
    │ ███
    │ ███
    │ ███
 0  └─────────────
      今日 昨日
```

**② エラー率のグラフ**
```
確認ポイント:
- 429エラーの発生数
- エラーが増加したタイミング
```

**③ レイテンシのグラフ**
```
確認ポイント:
- APIレスポンス時間
- 異常に遅い時間帯
```

---

## 🔢 Step 3: クォータ（割り当て）を確認

### 3-1. 左メニューから「割り当て」をクリック

または直接アクセス:
```
https://console.cloud.google.com/apis/api/pagespeedonline.googleapis.com/quotas
```

### 3-2. 確認すべき項目

```
項目                                現在値    上限
─────────────────────────────────────────────
Queries per day                     ?????    25,000
Queries per 100 seconds per user    ?????    240
```

**重要な確認ポイント**:
1. **Queries per day の現在値**
   - 25,000 に達しているか？
   - 何リクエスト使用済みか？

2. **リセット時刻**
   - 次のリセットはいつか？
   - タイムゾーンは？

3. **制限の種類**
   - 1日あたりの制限のみか？
   - 100秒あたりの制限もあるか？

---

## 🔑 Step 4: APIキーの使用状況を確認

### 4-1. 「認証情報」ページを開く

```
https://console.cloud.google.com/apis/credentials
```

### 4-2. 使用中のAPIキーをクリック

現在の `.env.local` のキー:
```bash
# 確認方法
cat .env.local | grep GOOGLE_PAGESPEED_API_KEY
```

### 4-3. 確認すべき設定

**① アプリケーションの制限**
```
選択肢:
□ なし（推奨されません）← これだと他でも使える
□ HTTPリファラー（ウェブサイト）
□ IPアドレス（ウェブサーバー、cronジョブなど）
□ Android アプリ
□ iOS アプリ
```

**② API の制限**
```
- 「キーを制限」が選択されているか？
- PageSpeed Insights API のみに制限されているか？
```

**③ 使用状況の統計**
- このキーからのリクエスト数
- 時間別の使用パターン

---

## 📸 確認結果を記録

以下をスクリーンショットまたはメモしてください:

### ✅ チェックリスト

- [ ] **過去24時間の総リクエスト数**: _____ リクエスト
- [ ] **Queries per day の現在値**: _____ / 25,000
- [ ] **急増したタイミング**: _____時頃
- [ ] **APIキーの制限設定**: 
  - [ ] なし（他のアプリでも使える）
  - [ ] HTTPリファラーで制限
  - [ ] その他: _____
- [ ] **次のリセット時刻**: _____
- [ ] **異常なパターン**: 
  - [ ] 短時間に大量リクエスト
  - [ ] 夜間に自動実行？
  - [ ] 複数のIPアドレスから？

---

## 🎯 確認後のアクション

### パターンA: 本当に25,000に達している
→ 新しいAPIキーを作成（別クォータ）

### パターンB: 他のプロジェクトで使われている
→ APIキーに制限を追加、または新規作成

### パターンC: 異常なリクエストパターン
→ ログ調査、自動実行の停止

### パターンD: クォータ設定が異なる
→ クォータ増加申請、または課金プランに変更

---

## 📝 報告フォーマット

確認後、以下の形式で報告してください:

```
【確認結果】
1. 過去24時間の総リクエスト数: _____
2. 現在のクォータ使用率: _____ / 25,000 (___%)
3. 急増したタイミング: _____
4. APIキーの制限: _____
5. 気づいた異常: _____
```
